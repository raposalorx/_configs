#!/bin/bash

# There can only be one
pgrep "${0##*/}" | grep -P '^((?!'$$').)*$' | xargs -L 1 kill

# Make sure we at least have the base dir
FOLDERS=("$@")
if (( ! ${#FOLDERS[@]} ))
then
  FOLDERS=('.')
  feh --bg-fill "$HOME/.backs/0cGG4pV.jpg"
  sleep 1m
fi

# Make them global
DIRS=$(for i in "${FOLDERS[@]}"
do
  printf "$HOME/.backs/%s " "$i"
done)

while true;
do

# Don't quote DIRS, we want the spaces to split out
readarray -d '' pics < <(find -L $DIRS -maxdepth 1 -type f \( -name '*.jpg' -o -name '*.jpeg' -o -name '*.png' \) -print0 | shuf -z)
#for i in $pics; do
#dunstify --appname="Backgrounds"  --urgency=low --icon="$i" Backgrounds "$(IFS=$'\n'; echo "${FOLDERS[*]}")"
#break
#done
for i in "${pics[@]}"
do
#    convert "$i" -geometry 1920x1080 -gravity center -background black -extent 1920x1080 $HOME/.swap.png
    echo "$i"
    feh --bg-fill "$i"
    #feh --bg-center $HOME/.swap.png
    #rm $HOME/.swap.png
    sleep 1m
done
done
